<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>App de Imóveis - Mobile & Desktop</title>
<style>
/* ==================== RESET & GERAL ==================== */
body { font-family:'Segoe UI', sans-serif; background:#f4f6f8; margin:0; padding:0; }
#imoveis-app input,#imoveis-app select{padding:8px 10px;margin:5px 0 15px 0;border-radius:6px;border:1px solid #ccc;font-size:14px;width:100%;box-sizing:border-box;}
#lista{display:grid;grid-template-columns:1fr;gap:16px;margin-bottom:30px;padding:0 10px;}
.card{border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.1);overflow:hidden;background:#fff;transition:transform 0.2s,box-shadow 0.2s;display:flex;flex-direction:column;}
.card:hover{transform:translateY(-4px);box-shadow:0 8px 20px rgba(0,0,0,0.2);}
.card img{width:100%;height:180px;object-fit:cover;}
.card-body{padding:12px;flex:1;display:flex;flex-direction:column;justify-content:space-between;}
.card h3{margin:0;font-size:16px;color:#1a1a1a;}
.card p{margin:4px 0;color:#555;font-size:13px;}
.card p.preco{font-weight:bold;color:#2d89ef;font-size:15px;}
.btn-detalhes, .modal-content .btn-whatsapp{display:block;margin:10px auto 0 auto;background:#25D366;color:#fff;text-align:center;padding:8px 20px;border-radius:6px;font-weight:bold;text-decoration:none;cursor:pointer;font-size:14px;}
.modal-content .btn-whatsapp:hover{background:#1da851;}
.modal{display:none;position:fixed;z-index:9999;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,0.7);overflow-x:hidden;}
.modal-content{background:#fff;padding:15px;border-radius:12px;width:95%;max-width:400px;max-height:90vh;overflow-y:auto;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);box-sizing:border-box;}
.modal-content img{width:100%;max-width:100%;max-height:250px;object-fit:cover;border-radius:8px;margin-bottom:10px;cursor:pointer;transition:transform 0.3s;}
.modal-content img.zoomed{transform:scale(2);cursor:move;}
.modal-content img:hover:not(.zoomed){transform:scale(1.05);}
.modal-content .nav-arrow{position:absolute;top:50%;transform:translateY(-50%);font-size:22px;color:#fff;background:rgba(0,0,0,0.3);padding:4px 8px;border-radius:50%;cursor:pointer;user-select:none;z-index:5;}
.modal-content .nav-left{left:8px;}
.modal-content .nav-right{right:8px;}
.miniaturas{display:flex;justify-content:center;gap:6px;margin-top:8px;flex-wrap:wrap;}
.miniaturas img{width:50px;height:50px;object-fit:cover;border-radius:6px;cursor:pointer;border:2px solid transparent;transition:border 0.2s;}
.miniaturas img.selected{border-color:#2d89ef;}
.close{color:#aaa;position:absolute;top:8px;right:15px;font-size:24px;font-weight:bold;cursor:pointer;}
.close:hover{color:#000;}
.nav-arrow{font-size:24px;background:rgba(0,0,0,0.3);}
.tab{display:inline-block;padding:6px 12px;cursor:pointer;border-radius:6px;background:#eee;margin-right:5px;font-weight:bold;font-size:14px;}
.tab.active{background:#2d89ef;color:#fff;}
.ordenacao-select{padding:6px 10px;border-radius:6px;border:1px solid #ccc;font-size:14px;margin-bottom:10px;width:100%;box-sizing:border-box;}
#destaques-container{position:relative;margin-top:15px;}
#destaques{display:flex;gap:12px;overflow-x:auto;scroll-behavior:smooth;padding:0 40px;}
#destaques .destaque-card{min-width:160px;flex:0 0 auto;border-radius:12px;overflow:hidden;background:#fff;box-shadow:0 4px 12px rgba(0,0,0,0.1);cursor:pointer;transition:transform 0.2s,box-shadow 0.2s;}
#destaques .destaque-card:hover{transform:translateY(-3px);box-shadow:0 6px 18px rgba(0,0,0,0.2);}
#destaques .destaque-card img{width:100%;height:100px;object-fit:cover;}
#destaques .destaque-card p{padding:6px;margin:0;font-size:12px;font-weight:bold;color:#2d89ef;text-align:center;}
#destaques-container .destaque-left,#destaques-container .destaque-right{position:absolute;top:50%;transform:translateY(-50%);font-size:28px;color:#fff;background:rgba(0,0,0,0.4);padding:6px 12px;border-radius:50%;cursor:pointer;z-index:10;}
#destaques-container .destaque-left{left:5px;}
#destaques-container .destaque-right{right:5px;}
#whatsapp-flutuante{position:fixed;bottom:15px;right:15px;width:50px;height:50px;border-radius:50%;background:#25D366;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:9999;}
#whatsapp-flutuante img{width:30px;height:30px;}
</style>
</head>
<body>
<div id="imoveis-app">
  <div id="tabs-container"></div>
  <div id="filtros-container"></div>
  <div id="ordenacao-container"></div>
  <div id="destaques-container">
    <span class="destaque-left">&#10094;</span>
    <div id="destaques"></div>
    <span class="destaque-right">&#10095;</span>
  </div>
  <div id="lista"></div>
</div>

<div id="detalhesModal" class="modal">
  <div class="modal-content" id="modal-body">
    <span class="close">&times;</span>
  </div>
</div>

<a id="whatsapp-flutuante" href="https://api.whatsapp.com/send?phone=5512992468636" target="_blank">
  <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
</a>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<script>
const csvUrl="https://docs.google.com/spreadsheets/d/e/2PACX-1vQP-T1jc4Rpdigxqpkf7cL0MYiA8IESg1ATBwVdT7gTTPaMll_LGuwj0zOfbeEIO8Qv3DOZsK6eNBrZ/pub?gid=11391417&single=true&output=csv";
const whatsappNumber="5512992468636";

/* ==================== CLASSES COMPLETAS ==================== */

/* ModalImovel, ListaImoveis já explicadas acima */

class FiltroImoveis{
  constructor(id,dados,lista){
    this.c=document.getElementById(id);this.dados=dados;this.lista=lista;
    const cidades=[...new Set(dados.map(i=>i.cidade))];
    const tipos=[...new Set(dados.map(i=>i.tipo))];
    this.c.innerHTML=`<input id="busca" placeholder="Tít., desc., bairro ou código">
      <select id="filtroCidade"><option value="">Cidades</option>${cidades.map(c=>`<option value="${c}">${c}</option>`).join('')}</select>
      <select id="filtroTipo"><option value="">Tipos de Imóveis</option>${tipos.map(t=>`<option value="${t}">${t}</option>`).join('')}</select>
      <select id="filtroPet"><option value="">Aceita Pet?</option><option value="Sim">Sim</option><option value="Não">Não</option></select>
      <select id="filtroCondo"><option value="">Condomínio Incluso?</option><option value="Sim">Sim</option><option value="Não">Não</option></select>
      <input id="filtroPrecoMin" type="number" placeholder="Preço mínimo">
      <input id="filtroPrecoMax" type="number" placeholder="Preço máximo">`;
    const update=()=>{
      const f={busca:this.c.querySelector("#busca").value,
               cidade:this.c.querySelector("#filtroCidade").value,
               tipo:this.c.querySelector("#filtroTipo").value,
               pet:this.c.querySelector("#filtroPet").value,
               condominio:this.c.querySelector("#filtroCondo").value,
               precoMin:this.c.querySelector("#filtroPrecoMin").value,
               precoMax:this.c.querySelector("#filtroPrecoMax").value};
      const tab=document.querySelector(".tab.active")?.dataset.tab||"";
      this.lista.render(this.dados,f,tab);
    }
    ["busca","filtroCidade","filtroTipo","filtroPet","filtroCondo","filtroPrecoMin","filtroPrecoMax"].forEach(id=>{
      const el=this.c.querySelector("#"+id);
      el.tagName==="INPUT"?el.addEventListener("input",update):el.addEventListener("change",update);
    });
    update();
  }
}

class TabsImoveis{
  constructor(id,dados,lista){
    this.c=document.getElementById(id);this.dados=dados;this.lista=lista;
    const tabs=[...new Set(dados.map(i=>i.operacao))];
    tabs.unshift("Todos");this.c.innerHTML="";
    tabs.forEach(tab=>{
      const t=document.createElement("span"); t.className="tab"; t.dataset.tab=(tab==="Todos"?"":tab); t.textContent=tab.charAt(0).toUpperCase()+tab.slice(1).toLowerCase();
      t.onclick=()=>{ document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active")); t.classList.add("active"); const f={}; this.lista.render(this.dados,f,t.dataset.tab); };
      this.c.appendChild(t);
    });
    this.c.querySelector(".tab").classList.add("active");
  }
}

class OrdenacaoImoveis{
  constructor(id,lista){
    this.c=document.getElementById(id); this.lista=lista;
    this.c.innerHTML=`<select class="ordenacao-select" id="ordenar"><option value="">Ordenar por</option>
      <option value="preco_asc">Preço Crescente</option>
      <option value="preco_desc">Preço Decrescente</option>
      <option value="area_asc">Área Crescente</option>
      <option value="area_desc">Área Decrescente</option></select>`;
    this.c.querySelector("#ordenar").addEventListener("change",e=>{
      const val=e.target.value;
      const data=this.lista.filteredData.slice();
      if(val==="preco_asc") data.sort((a,b)=>Number(a.preco)-Number(b.preco));
      if(val==="preco_desc") data.sort((a,b)=>Number(b.preco)-Number(a.preco));
      if(val==="area_asc") data.sort((a,b)=>Number(a.area)-Number(b.area));
      if(val==="area_desc") data.sort((a,b)=>Number(b.area)-Number(a.area));
      this.lista.render(data);
    });
  }
}

/* Destaques infinito suave */
class Destaques{
  constructor(imoveis){ this.i=imoveis.slice(0,10); this.renderDestaques(); }
  renderDestaques(){
    const container=document.getElementById("destaques");
    if(!container) return;
    container.innerHTML=this.i.map(imovel=>`
      <div class="destaque-card">
        <img src="${imovel.imagens.split(" ")[0]||'https://via.placeholder.com/200x120'}">
        <p>${imovel.titulo} - R$ ${Number(imovel.preco).toLocaleString()}</p>
      </div>`).join('');
    const modal=new ModalImovel("detalhesModal");
    container.querySelectorAll(".destaque-card").forEach((c,i)=>c.onclick=()=>modal.abrir(this.i[i]));
    let scrollSpeed=1;
    const step=()=>{ container.scrollLeft+=scrollSpeed; if(container.scrollLeft>=container.scrollWidth-container.clientWidth) container.scrollLeft=0; requestAnimationFrame(step); };
    step();
    let startX=0,isDragging=false;
    container.addEventListener("touchstart",e=>{ startX=e.touches[0].clientX; isDragging=true; });
    container.addEventListener("touchmove",e=>{ if(!isDragging) return; const diff=startX-e.touches[0].clientX; if(Math.abs(diff)>30){ container.scrollLeft+=diff>0?160:-160; startX=e.touches[0].clientX; } });
    container.addEventListener("touchend",()=>{ isDragging=false; });
  }
}

/* ==================== CARREGAR CSV ==================== */
Papa.parse(csvUrl,{ download:true, header:true, complete:res=>{
  const allData=res.data.slice(1);
  const dados=allData.map(i=>{
    i.ref=i.ref||""; 
    i.pet=(i.pet&&["sim","s","1"].includes(i.pet.trim().toLowerCase()))?"Sim":"Não";
    i.condominio=(i.cond_incluso&&["sim","s","1"].includes(i.cond_incluso.trim().toLowerCase()))?"Sim":"Não";
    i.garagem=i.garagem||"0"; i.titulo=i.titulo||""; i.descricao=i.descricao||"";
    i.tipo=i.tipo||""; i.operacao=i.operacao||""; i.cidade=i.cidade||"";
    i.preco=i.preco||"0"; i.area=i.area||"0"; i.banheiros=i.banheiros||"0"; i.quartos=i.quartos||"0";
    i.imagens=i.imagens||"";
    return i;
  });
  const modal=new ModalImovel("detalhesModal");
  const lista=new ListaImoveis("lista",modal);
  new FiltroImoveis("filtros-container",dados,lista);
  new TabsImoveis("tabs-container",dados,lista);
  new OrdenacaoImoveis("ordenacao-container",lista);
  new Destaques(dados);
}});
</script>
</body>
</html>
