<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>App de Imóveis</title>
  <style>
/* ==================== RESET & GERAL ==================== */
body {
  font-family: 'Segoe UI', sans-serif;
  background: #f4f6f8;
  margin: 0;
  padding: 0;
}
#imoveis-app input, #imoveis-app select {
  padding: 8px 10px;
  margin: 5px 0 15px 0;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 14px;
  width: 100%;
  box-sizing: border-box;
}
#lista {
  display: grid;
  grid-template-columns: 1fr;
  gap: 16px;
  margin-bottom: 30px;
  padding: 0 10px;
}

/* ==================== CARD ==================== */
.card {
  border-radius: 12px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.1);
  overflow: hidden;
  background: #fff;
  transition: transform 0.2s, box-shadow 0.2s;
  display: flex;
  flex-direction: column;
  position: relative;
}
.card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.2);
}
.card img {
  width: 100%;
  height: 180px;
  object-fit: cover;
}
.card-body {
  padding: 12px;
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}
.card h3 {
  margin: 0;
  font-size: 16px;
  color: #1a1a1a;
}
.card p {
  margin: 4px 0;
  color: #555;
  font-size: 13px;
}
.card p.preco {
  font-weight: bold;
  color: #2d89ef;
  font-size: 15px;
}
.btn-detalhes, .modal-content .btn-whatsapp {
  display: block;
  margin: 10px auto 0 auto;
  background: #25D366;
  color: #fff;
  text-align: center;
  padding: 8px 20px;
  border-radius: 6px;
  font-weight: bold;
  text-decoration: none;
  cursor: pointer;
  font-size: 14px;
  transition: transform 0.3s ease;
  animation: pulse 2s infinite;
}
.btn-detalhes:hover { transform: scale(1.08); }
.modal-content .btn-whatsapp:hover { background: #1da851; }
@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

/* ==================== MODAL ==================== */
.modal {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.7);
  overflow-x: hidden;
  opacity: 0;
  transition: opacity 0.4s ease;
}
.modal.show {
  display: block;
  opacity: 1;
}
.modal-content {
  background: #fff;
  padding: 15px;
  border-radius: 12px;
  width: 95%;
  max-width: 400px;
  max-height: 90vh;
  overflow-y: auto;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%,-50%) scale(0.9);
  box-sizing: border-box;
  opacity: 0;
  transition: all 0.4s ease;
}
.modal.show .modal-content {
  opacity: 1;
  transform: translate(-50%,-50%) scale(1);
}
@media (min-width: 900px) {
  .modal-content {
    max-width: 800px;
    max-height: 95vh; /* altura maior no PC */
    padding: 25px;
  }
}
.modal-content img {
  width: 100%;
  max-width: 100%;
  max-height: 250px;
  object-fit: cover;
  border-radius: 8px;
  margin-bottom: 10px;
  cursor: pointer;
  transition: transform 0.3s;
}
.close {
  color: #aaa;
  position: absolute;
  top: 8px;
  right: 15px;
  font-size: 24px;
  font-weight: bold;
  cursor: pointer;
}
.close:hover { color: #000; }

/* ==================== RESPONSIVO ==================== */
@media (min-width: 600px) { #lista { grid-template-columns: repeat(2, 1fr); gap: 16px; padding: 0 20px; } }
@media (min-width: 900px) { #lista { grid-template-columns: repeat(3, 1fr); gap: 20px; padding: 0 30px; } }
  </style>
</head>
<body>

<!-- App -->
<div id="imoveis-app">
  <div id="tabs-container"></div>
  <div id="filtros-container"></div>
  <div id="ordenacao-container"></div>
  <div id="lista"></div>
  
  <!-- Modal -->
  <div id="detalhesModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <div id="modal-body"></div>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQP-T1jc4Rpdigxqpkf7cL0MYiA8IESg1ATBwVdT7gTTPaMll_LGuwj0zOfbeEIO8Qv3DOZsK6eNBrZ/pub?gid=11391417&single=true&output=csv";
const whatsappNumber = "5512992468636";

/* ==================== CLASSES ==================== */
class ModalImovel {
  constructor(id){
    this.modal=document.getElementById(id);
    this.body=document.getElementById("modal-body");
    this.closeBtn=this.modal.querySelector(".close");
    this.closeBtn.onclick=()=>this.fechar();
    window.onclick=e=>{if(e.target==this.modal)this.fechar();};
  }
  abrir(html){
    this.body.innerHTML=html;
    this.modal.classList.add("show");
  }
  fechar(){
    this.modal.classList.remove("show");
    setTimeout(()=>{this.modal.style.display="none";},400);
  }
}

class ListaImoveis {
  constructor(id,modal){ this.el=document.getElementById(id); this.modal=modal; }
  render(dados){
    this.el.innerHTML="";
    dados.forEach(i=>{
      let card=document.createElement("div");
      card.className="card";
      let img=i.imagens?i.imagens.split(",")[0]:"https://via.placeholder.com/300x200";
      card.innerHTML=`
        <img src="${img}" alt="${i.titulo}">
        <div class="card-body">
          <h3>${i.titulo}</h3>
          <p>${i.cidade}</p>
          <p class="preco">R$ ${i.preco}</p>
          <button class="btn-detalhes">Detalhes</button>
        </div>`;
      card.querySelector(".btn-detalhes").onclick=()=>{
        let html=`<h2>${i.titulo}</h2>
                  <p><b>Cidade:</b> ${i.cidade}</p>
                  <p><b>Preço:</b> R$ ${i.preco}</p>
                  <p>${i.descricao}</p>
                  <a href="https://wa.me/${whatsappNumber}?text=Tenho interesse no imóvel ${i.titulo}" target="_blank" class="btn-whatsapp">Falar no WhatsApp</a>`;
        this.modal.abrir(html);
      };
      this.el.appendChild(card);
    });
  }
}

class FiltroImoveis {
  constructor(id,dados,lista){
    this.el=document.getElementById(id);
    this.dados=dados; this.lista=lista;
    this.render();
  }
  render(){
    this.el.innerHTML=`<input type="text" id="filtro-cidade" placeholder="Filtrar por cidade">`;
    document.getElementById("filtro-cidade").addEventListener("input",e=>{
      let val=e.target.value.toLowerCase();
      let filtrados=this.dados.filter(i=>i.cidade.toLowerCase().includes(val));
      this.lista.render(filtrados);
    });
    this.lista.render(this.dados);
  }
}

class TabsImoveis {
  constructor(id,dados,lista){
    this.el=document.getElementById(id);
    this.dados=dados; this.lista=lista;
    this.render();
  }
  render(){
    this.el.innerHTML=`<span class="tab active" data-tab="todos">Todos</span>
                       <span class="tab" data-tab="venda">Venda</span>
                       <span class="tab" data-tab="aluguel">Aluguel</span>`;
    this.el.querySelectorAll(".tab").forEach(tab=>{
      tab.onclick=()=>{
        this.el.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
        tab.classList.add("active");
        let tipo=tab.dataset.tab;
        if(tipo=="todos")this.lista.render(this.dados);
        else this.lista.render(this.dados.filter(i=>i.operacao.toLowerCase()==tipo));
      };
    });
  }
}

class OrdenacaoImoveis {
  constructor(id,lista){
    this.el=document.getElementById(id);
    this.lista=lista;
    this.render();
  }
  render(){
    this.el.innerHTML=`<select id="ordenacao">
      <option value="">Ordenar</option>
      <option value="preco-asc">Preço ↑</option>
      <option value="preco-desc">Preço ↓</option>
    </select>`;
    document.getElementById("ordenacao").onchange=e=>{
      let val=e.target.value;
      let cards=[...this.lista.el.querySelectorAll(".card")];
      if(val=="preco-asc"||val=="preco-desc"){
        cards.sort((a,b)=>{
          let pa=parseFloat(a.querySelector(".preco").innerText.replace(/[^0-9]/g,""));
          let pb=parseFloat(b.querySelector(".preco").innerText.replace(/[^0-9]/g,""));
          return val=="preco-asc"?pa-pb:pb-pa;
        });
        this.lista.el.innerHTML="";
        cards.forEach(c=>this.lista.el.appendChild(c));
      }
    };
  }
}

class Destaques {
  constructor(dados){
    console.log("Destaques iniciais",dados.slice(0,3));
  }
}

/* ==================== CARREGAR CSV ==================== */
Papa.parse(csvUrl,{
  download:true,
  header:true,
  complete: res => {
    const dados=res.data.map(i=>({
      titulo:i.titulo||"Imóvel",
      cidade:i.cidade||"",
      preco:i.preco||"0",
      descricao:i.descricao||"",
      imagens:i.imagens||"",
      operacao:i.operacao||""
    }));
    const modal=new ModalImovel("detalhesModal");
    const lista=new ListaImoveis("lista",modal);
    new FiltroImoveis("filtros-container",dados,lista);
    new TabsImoveis("tabs-container",dados,lista);
    new OrdenacaoImoveis("ordenacao-container",lista);
    new Destaques(dados);
  }
});
</script>
</body>
</html>
