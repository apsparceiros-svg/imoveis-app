<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>App de Imóveis</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
body { font-family:'Segoe UI',sans-serif; background:#f4f6f8; margin:0; padding:0; }
#imoveis-app input,#imoveis-app select { padding:8px 10px; margin:5px 5px 15px 0; border-radius:6px; border:1px solid #ccc; font-size:14px; }
#lista { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; margin-bottom:30px; }
.card { border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.1); overflow:hidden; background:#fff; transition: transform 0.2s, box-shadow 0.2s; display:flex; flex-direction:column; }
.card:hover { transform: translateY(-6px); box-shadow:0 12px 24px rgba(0,0,0,0.2); }
.card img { width:100%; height:180px; object-fit:cover; cursor:pointer; }
.card-body { padding:12px; flex:1; display:flex; flex-direction:column; justify-content:space-between; }
.card h3 { margin:0; font-size:16px; color:#1a1a1a; }
.card p { margin:4px 0; color:#555; font-size:13px; }
.card p.preco { font-weight:bold; color:#2d89ef; font-size:15px; }
.btn-detalhes, .modal-content .btn-whatsapp { display:block; margin:10px auto 0 auto; background:#25D366; color:#fff; text-align:center; padding:8px 20px; border-radius:50px; font-weight:bold; text-decoration:none; cursor:pointer; font-size:14px; transition: background 0.2s; }
.modal-content .btn-whatsapp:hover { background:#1da851; }
.modal { display:none; position:fixed; z-index:9999; left:0; top:0; width:100%; height:100%; background-color: rgba(0,0,0,0.6); overflow-x:hidden; }
.modal-content { background:#fff; padding:20px; border-radius:12px; width:90%; max-width:500px; max-height:90vh; overflow-y:auto; overflow-x:hidden; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); box-sizing:border-box; }
.modal-content img { width:100%; max-height:300px; object-fit:cover; border-radius:8px; margin-bottom:10px; cursor:pointer; transition: transform 0.3s; }
.modal-content img.zoomed { transform: scale(2); cursor: move; }
.modal-content img:hover:not(.zoomed) { transform: scale(1.05); }
.modal-content .nav-arrow { position:absolute; top:50%; transform:translateY(-50%); font-size:28px; color:#fff; background: rgba(0,0,0,0.4); padding:6px 12px; border-radius:50%; cursor:pointer; user-select:none; z-index:5; }
.modal-content .nav-left { left: -10px; } 
.modal-content .nav-right { right: -10px; }
.miniaturas { display:flex; justify-content:center; gap:8px; margin-top:10px; flex-wrap: wrap; }
.miniaturas img { width:60px; height:60px; object-fit:cover; border-radius:6px; cursor:pointer; border:2px solid transparent; transition: border 0.2s; max-width:100%; }
.miniaturas img.selected { border-color:#2d89ef; }
.close { color:#aaa; position:absolute; top:10px; right:20px; font-size:28px; font-weight:bold; cursor:pointer; }
.close:hover { color:#000; }
.nav-arrow { position:absolute; top:50%; transform:translateY(-50%); font-size:36px; color:#fff; background:rgba(0,0,0,0.4); padding:6px 12px; border-radius:50%; cursor:pointer; user-select:none; }
.tab { display:inline-block; padding:8px 16px; cursor:pointer; border-radius:6px; background:#eee; margin-right:5px; font-weight:bold; }
.tab.active { background:#2d89ef; color:#fff; }
.ordenacao-select { padding:6px 10px; border-radius:6px; border:1px solid #ccc; font-size:14px; margin-right:10px; }
#destaques-container { display:flex; align-items:center; position:relative; margin:20px 0; overflow:hidden; }
#destaques { display:flex; gap:16px; overflow-x:auto; scroll-behavior:smooth; flex:1; }
#destaques::-webkit-scrollbar { display:none; }
#destaques .destaque-card { min-width:200px; flex:0 0 auto; border-radius:12px; overflow:hidden; background:#fff; box-shadow:0 4px 12px rgba(0,0,0,0.1); cursor:pointer; transition: transform 0.2s, box-shadow 0.2s; }
#destaques .destaque-card:hover { transform: translateY(-5px); box-shadow:0 8px 20px rgba(0,0,0,0.2); }
#destaques .destaque-card img { width:100%; height:120px; object-fit:cover; }
#destaques .destaque-card p { padding:8px; margin:0; font-size:14px; font-weight:bold; color:#2d89ef; text-align:center; }
.destaque-left { left:0; position:absolute; z-index:10; }
.destaque-right { right:0; position:absolute; z-index:10; }
#whatsapp-flutuante { position:fixed; right:20px; top:50%; transform:translateY(-50%); background:#25D366; color:#fff; padding:12px 16px; border-radius:50px; text-decoration:none; font-weight:bold; z-index:9999; cursor:pointer; transition: top 0.2s ease; }
@media(max-width:768px){#lista{grid-template-columns:1fr;} .card img{height:150px;} .tab{overflow-x:auto; white-space:nowrap;}}
</style>
</head>
<body>

<!-- Destaques -->
<div id="destaques-container">
  <span class="nav-arrow destaque-left">&#10094;</span>
  <div id="destaques"></div>
  <span class="nav-arrow destaque-right">&#10095;</span>
</div>

<div id="imoveis-app">
  <div id="tabs-container"></div>
  <div id="filtros-container"></div>
  <div id="ordenacao-container"></div>
  <div id="lista"></div>

  <div id="detalhesModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <div id="modal-body"></div>
    </div>
  </div>
</div>

<a id="whatsapp-flutuante" href="https://api.whatsapp.com/send?phone=5512992468636" target="_blank">WhatsApp</a>

<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQP-T1jc4Rpdigxqpkf7cL0MYiA8IESg1ATBwVdT7gTTPaMll_LGuwj0zOfbeEIO8Qv3DOZsK6eNBrZ/pub?gid=11391417&single=true&output=csv";
const btnWhats = document.getElementById("whatsapp-flutuante");
function moveBtn(x,y){let offset=20,maxY=window.innerHeight-btnWhats.offsetHeight-offset,minY=offset,top=y-btnWhats.offsetHeight/2; top=Math.max(minY, Math.min(maxY, top)); btnWhats.style.top = top + 'px';}
document.addEventListener('mousemove', e => moveBtn(e.clientX, e.clientY));
document.addEventListener('touchmove', e => {if(e.touches.length>0) moveBtn(e.touches[0].clientX,e.touches[0].clientY);});

// === Classes de Modal, Lista, Tabs, Filtros, Ordenacao, Destaques ===
class ModalImovel{constructor(id){this.modal=document.getElementById(id); this.body=this.modal.querySelector("#modal-body"); this.close=this.modal.querySelector(".close"); this.close.onclick=()=>this.fechar(); window.onclick=e=>{if(e.target==this.modal)this.fechar();}}fechar(){this.modal.style.display="none"; document.body.style.overflow=""; btnWhats.style.display="block";}abrir(imovel){btnWhats.style.display="none"; const imgs=imovel.imagens.split(" ").filter(i=>i); let idxImg=0; this.body.innerHTML=`<h2>${imovel.titulo}</h2><p><b>Código:</b> ${imovel.ref||''}</p><p><b>Preço:</b> R$ ${Number(imovel.preco).toLocaleString()} | <b>Cidade:</b> ${imovel.cidade} | <b>Bairro:</b> ${imovel.bairro} | <b>Tipo:</b> ${imovel.tipo} | <b>Operação:</b> ${imovel.operacao}</p><p>${imovel.descricao}</p><div style="position:relative; overflow:hidden;"><img id="main-img" src="${imgs[0]||'https://via.placeholder.com/400x250'}"><span class="nav-arrow nav-left">&#10094;</span><span class="nav-arrow nav-right">&#10095;</span></div><div class="miniaturas">${imgs.map((s,i)=>`<img src="${s}" class="${i===0?'selected':''}">`).join('')}</div><a class="btn-whatsapp" href="https://api.whatsapp.com/send?phone=5512992468636&text=Olá,%20interessei-me%20no%20imóvel%20${imovel.titulo}" target="_blank">WhatsApp</a>`;
const main=this.body.querySelector("#main-img"), mini=this.body.querySelectorAll(".miniaturas img"), left=this.body.querySelector(".nav-left"), right=this.body.querySelector(".nav-right");
let idxImg=0; const update=i=>{main.src=imgs[i]; mini.forEach((m,j)=>m.classList.toggle("selected",i===j)); idxImg=i;}; mini.forEach((m,i)=>m.onclick=()=>update(i)); left.onclick=()=>update((idxImg-1+imgs.length)%imgs.length); right.onclick=()=>update((idxImg+1)%imgs.length);
this.modal.style.display="block";}}

Papa.parse(csvUrl,{download:true,header:true,skipEmptyLines:true,complete:res=>{
  const dados=res.data.slice(1).map(i=>{i.ref=i.ref||""; i.pet=(i.pet&&["sim","s","1"].includes(i.pet.trim().toLowerCase()))?"Sim":"Não"; i.condominio=(i.cond_incluso&&["sim","s","1"].includes(i.cond_incluso.trim().toLowerCase()))?"Sim":"Não"; i.garagem=i.garagem||"0"; i.titulo=i.titulo||""; i.descricao=i.descricao||""; i.tipo=i.tipo||""; i.operacao=i.operacao||""; i.cidade=i.cidade||""; i.preco=i.preco||"0"; i.area=i.area||"0"; i.banheiros=i.banheiros||"0"; i.quartos=i.quartos||"0"; i.imagens=i.imagens||""; return i;});
  const modal=new ModalImovel("detalhesModal");
  const lista=document.getElementById("lista");
  const renderCard=imovel=>{const c=document.createElement("div"); c.className="card"; c.innerHTML=`<img src="${imovel.imagens.split(" ")[0]||'https://via.placeholder.com/400x250'}"><div class="card-body"><h3>${imovel.titulo}</h3><p class="preco">R$ ${Number(imovel.preco).toLocaleString()}</p><p>${imovel.cidade} | ${imovel.tipo}</p><button class="btn-detalhes">Detalhes</button></div>`; c.querySelector(".btn-detalhes").onclick=()=>modal.abrir(imovel); c.querySelector("img").onclick=()=>modal.abrir(imovel); lista.appendChild(c); };
  dados.forEach(renderCard);
  // Destaques clicáveis
  const destaqueContainer=document.getElementById("destaques"); dados.slice(0,10).forEach(imovel=>{const d=document.createElement("div"); d.className="destaque-card"; d.innerHTML=`<img src="${imovel.imagens.split(" ")[0]||'https://via.placeholder.com/200x120'}"><p>${imovel.titulo} - R$ ${Number(imovel.preco).toLocaleString()}</p>`; d.onclick=()=>modal.abrir(imovel); destaqueContainer.appendChild(d);});
});
</script>
</body>
</html>
