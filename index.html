<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>App de Im√≥veis Profissional</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
body{font-family:'Segoe UI',sans-serif;background:#f4f6f8;margin:0;padding:0;}
#lista{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:30px;}
.card{border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.1);overflow:hidden;background:#fff;transition: transform 0.2s, box-shadow 0.2s, opacity 0.4s ease, transform 0.4s ease;display:flex;flex-direction:column;opacity:0;transform:translateY(20px);}
.card.show{opacity:1;transform:translateY(0);}
.card img{width:100%;height:180px;object-fit:cover;cursor:pointer;}
.card-body{padding:12px;flex:1;display:flex;flex-direction:column;justify-content:space-between;}
.card h3{margin:0;font-size:16px;color:#1a1a1a;}
.card p{margin:4px 0;color:#555;font-size:13px;}
.card p.preco{font-weight:bold;color:#2d89ef;font-size:15px;}
.modal{display:none;position:fixed;z-index:9999;left:0;top:0;width:100%;height:100%;background-color: rgba(0,0,0,0.6);}
.modal-content{background:#fff;padding:20px;border-radius:12px;width:90%;max-width:500px;max-height:90vh;overflow-y:auto;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) scale(0.95);opacity:0;transition:opacity 0.3s, transform 0.3s;}
.modal-content.show{opacity:1;transform:translate(-50%,-50%) scale(1);}
.modal-content img{width:100%;max-height:300px;object-fit:cover;border-radius:8px;margin-bottom:10px;cursor:pointer;transition: transform 0.3s;}
.miniaturas{display:flex;justify-content:center;gap:8px;margin-top:10px;flex-wrap:wrap;}
.miniaturas img{width:60px;height:60px;object-fit:cover;border-radius:6px;cursor:pointer;border:2px solid transparent;transition:border 0.2s, transform 0.3s;}
.miniaturas img.selected{border-color:#2d89ef;transform:scale(1.05);}
.close{color:#aaa;position:absolute;top:10px;right:20px;font-size:28px;font-weight:bold;cursor:pointer;}
.close:hover{color:#000;}
#destaques-container{display:flex;align-items:center;position:relative;margin:20px 0;overflow:hidden;}
#destaques{display:flex;gap:16px;overflow-x:auto;scroll-behavior:smooth;flex:1;padding-bottom:10px;scroll-snap-type:x mandatory;}
#destaques::-webkit-scrollbar{display:none;}
#destaques .destaque-card{min-width:200px;flex:0 0 auto;border-radius:12px;overflow:hidden;background:#fff;box-shadow:0 4px 12px rgba(0,0,0,0.1);cursor:pointer;transition: transform 0.2s, box-shadow 0.2s, opacity 0.4s ease;opacity:0;scroll-snap-align:start;}
#destaques .destaque-card.show{opacity:1;}
#destaques .destaque-card img{width:100%;height:120px;object-fit:cover;}
#destaques .destaque-card p{padding:8px;margin:0;font-size:14px;font-weight:bold;color:#2d89ef;text-align:center;}
.destaque-left,.destaque-right{position:absolute;top:50%;transform:translateY(-50%);font-size:36px;color:#fff;background:rgba(0,0,0,0.4);padding:6px 12px;border-radius:50%;cursor:pointer;user-select:none;z-index:10;}
.destaque-left{left:0;}
.destaque-right{right:0;}
#whatsapp-flutuante {position:fixed;bottom:20px;right:20px;width:60px;height:60px;border-radius:50%;background:url('https://cdn-icons-png.flaticon.com/512/733/733585.png') no-repeat center center;background-size:cover;box-shadow:0 4px 12px rgba(0,0,0,0.3);cursor:pointer;z-index:9999;display:flex;align-items:center;justify-content:center;text-decoration:none;animation:pulse 2.5s infinite;transition:transform 0.2s;}
#whatsapp-flutuante:hover{transform:scale(1.1);animation:none;}
@keyframes pulse{0%{transform:scale(1);}50%{transform:scale(1.08);}100%{transform:scale(1);}}
.filtro, .ordenacao{margin:10px 0;display:flex;gap:10px;flex-wrap:wrap;}
select{padding:6px 10px;border-radius:6px;border:1px solid #ccc;font-size:14px;}
@media(max-width:768px){#lista{grid-template-columns:1fr;} .card img{height:150px;}}
</style>
</head>
<body>

<div id="destaques-container">
  <span class="destaque-left">&#10094;</span>
  <div id="destaques"></div>
  <span class="destaque-right">&#10095;</span>
</div>

<div id="imoveis-app">
  <div id="tabs-container"></div>
  <div class="filtro" id="filtros-container"></div>
  <div class="ordenacao" id="ordenacao-container"></div>
  <div id="lista"></div>

  <div id="detalhesModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <img id="modal-main-img" src="" alt="Imagem do Im√≥vel">
      <div class="miniaturas" id="modal-thumbnails"></div>
      <div id="modal-body"></div>
    </div>
  </div>
</div>

<a id="whatsapp-flutuante" href="https://api.whatsapp.com/send?phone=5512992468636" target="_blank">üí¨</a>

<script>
// ====== Classes ======
class ModalImovel{
  constructor(modalId){
    this.modal=document.getElementById(modalId);
    this.modalContent=this.modal.querySelector('.modal-content');
    this.mainImg=this.modal.querySelector('#modal-main-img');
    this.thumbsContainer=this.modal.querySelector('#modal-thumbnails');
    this.modal.querySelector('.close').addEventListener('click',()=>this.fechar());
  }
  abrir(imagens, infoHtml){
    this.mainImg.src=imagens[0];
    this.thumbsContainer.innerHTML='';
    imagens.forEach(src=>{
      const img=document.createElement('img'); img.src=src;
      img.addEventListener('click',()=>this.mainImg.src=src);
      this.thumbsContainer.appendChild(img);
    });
    this.modal.querySelector('#modal-body').innerHTML=infoHtml;
    this.modal.style.display='block';
    setTimeout(()=>this.modalContent.classList.add('show'),10);
  }
  fechar(){this.modalContent.classList.remove('show'); this.modal.style.display='none';}
}

class ListaImoveis{
  constructor(listaId, modal){
    this.container=document.getElementById(listaId);
    this.modal=modal;
    this.dadosOriginais=[];
  }
  setDados(dados){this.dadosOriginais=dados; this.render(dados);}
  render(dados){
    this.container.innerHTML='';
    dados.forEach(i=>{
      const card=document.createElement('div'); card.className='card';
      const imgs=i.imagens.split(',').map(s=>s.trim());
      card.innerHTML=`<img data-src="${imgs[0]}" class="lazy"><div class="card-body"><h3>${i.titulo}</h3><p>${i.descricao}</p><p class="preco">${i.preco}</p></div>`;
      card.querySelector('img').addEventListener('click',()=>this.modal.abrir(imgs,`<h3>${i.titulo}</h3><p>${i.descricao}</p><p>Pre√ßo: ${i.preco}</p>`));
      this.container.appendChild(card);
      setTimeout(()=>card.classList.add('show'),50);
    });
    this.lazyLoadImages();
  }
  lazyLoadImages(){
    const imgs=document.querySelectorAll('.lazy');
    const observer=new IntersectionObserver((entries, obs)=>{
      entries.forEach(entry=>{
        if(entry.isIntersecting){
          const img=entry.target;
          img.src=img.dataset.src;
          img.classList.remove('lazy');
          obs.unobserve(img);
        }
      });
    }, {rootMargin:'100px'});
    imgs.forEach(img=>observer.observe(img));
  }
}

class FiltroImoveis{
  constructor(containerId, dados, lista){
    this.container=document.getElementById(containerId);
    this.dados=dados;
    this.lista=lista;
    this.render();
  }
  render(){
    const tipos=[...new Set(this.dados.map(i=>i.tipo))];
    const cidades=[...new Set(this.dados.map(i=>i.cidade))];
    const operacoes=[...new Set(this.dados.map(i=>i.operacao))];
    this.container.innerHTML='';
    const selectTipo=document.createElement('select');
    selectTipo.innerHTML=`<option value="">Todos os tipos</option>`+tipos.map(t=>`<option value="${t}">${t}</option>`).join('');
    const selectCidade=document.createElement('select');
    selectCidade.innerHTML=`<option value="">Todas as cidades</option>`+cidades.map(c=>`<option value="${c}">${c}</option>`).join('');
    const selectOper=document.createElement('select');
    selectOper.innerHTML=`<option value="">Todas opera√ß√µes</option>`+operacoes.map(o=>`<option value="${o}">${o}</option>`).join('');
    [selectTipo, selectCidade, selectOper].forEach(s=>{
      s.addEventListener('change',()=>this.filtrar(selectTipo.value, selectCidade.value, selectOper.value));
      this.container.appendChild(s);
    });
  }
  filtrar(tipo,cidade,oper){
    let filtrado=this.dados;
    if(tipo) filtrado=filtrado.filter(i=>i.tipo===tipo);
    if(cidade) filtrado=filtrado.filter(i=>i.cidade===cidade);
    if(oper) filtrado=filtrado.filter(i=>i.operacao===oper);
    this.lista.render(filtrado);
  }
}

class OrdenacaoImoveis{
  constructor(containerId, lista){
    this.container=document.getElementById(containerId);
    this.lista=lista;
    this.render();
  }
  render(){
    const select=document.createElement('select');
    select.innerHTML='<option value="">Ordenar por</option><option value="preco-cresc">Pre√ßo ‚Üë</option><option value="preco-decresc">Pre√ßo ‚Üì</option><option value="area-cresc">√Årea ‚Üë</option><option value="area-decresc">√Årea ‚Üì</option>';
    select.addEventListener('change',()=>this.ordenar(select.value));
    this.container.appendChild(select);
  }
  ordenar(op){
    let dados=[...this.lista.dadosOriginais];
    switch(op){
      case 'preco-cresc': dados.sort((a,b)=>parseFloat(a.preco)-parseFloat(b.preco)); break;
      case 'preco-decresc': dados.sort((a,b)=>parseFloat(b.preco)-parseFloat(a.preco)); break;
      case 'area-cresc': dados.sort((a,b)=>parseFloat(a.area)-parseFloat(b.area)); break;
      case 'area-decresc': dados.sort((a,b)=>parseFloat(b.area)-parseFloat(a.area)); break;
    }
    this.lista.render(dados);
  }
}

class Destaques{
  constructor(dados){
    const container=document.getElementById('destaques');
    dados.slice(0,5).forEach(i=>{
      const card=document.createElement('div'); card.className='destaque-card';
      const imgs=i.imagens.split(',').map(s=>s.trim());
      card.innerHTML=`<img data-src="${imgs[0]}" class="lazy"><p>${i.titulo}</p>`;
      container.appendChild(card);
      setTimeout(()=>card.classList.add('show'),100);
    });
    this.lazyLoadImages();
    this.setupLoop(container);
  }
  lazyLoadImages(){
    const imgs=document.querySelectorAll('#destaques .lazy');
    const observer=new IntersectionObserver((entries, obs)=>{
      entries.forEach(entry=>{
        if(entry.isIntersecting){
          const img=entry.target;
          img.src=img.dataset.src;
          img.classList.remove('lazy');
          obs.unobserve(img);
        }
      });
    }, {rootMargin:'100px'});
    imgs.forEach(img=>observer.observe(img));
  }
  setupLoop(container){
    const cards=Array.from(container.children);
    for(let i=cards.length-2;i<cards.length;i++){ const clone=cards[i].cloneNode(true); clone.classList.add('clone'); container.insertBefore(clone,container.firstChild);}
    for(let i=0;i<2;i++){ const clone=cards[i].cloneNode(true); clone.classList.add('clone'); container.appendChild(clone);}
    container.scrollLeft=220*2;
    let scrollSpeed=1, running=true;
    function animate(){if(running){container.scrollLeft+=scrollSpeed; const maxScroll=container.scrollWidth-container.clientWidth; if(container.scrollLeft>=maxScroll-220){container.scrollLeft=220*2;}} requestAnimationFrame(animate);}
    animate();
    container.addEventListener('mouseenter',()=>running=false);
    container.addEventListener('mouseleave',()=>running=true);
    let startX=0;
    container.addEventListener('touchstart',e=>{startX=e.touches[0].clientX;});
    container.addEventListener('touchmove',e=>{
      const diff=startX-e.touches[0].clientX;
      container.scrollLeft+=diff;
      startX=e.touches[0].clientX;
    });
  }
}

// ====== Inicializa√ß√£o ======
const modal=new ModalImovel("detalhesModal");
const lista=new ListaImoveis("lista",modal);

Papa.parse("imoveis.csv",{download:true,header:true,skipEmptyLines:true,complete:res=>{
  const dados=res.data.slice(1).map(i=>{i.imagens=i.imagens||''; i.preco=i.preco||0; i.area=i.area||0; return i;});
  lista.setDados(dados);
  new FiltroImoveis("filtros-container",dados,lista);
  new OrdenacaoImoveis("ordenacao-container",lista);
  new Destaques(dados);
}});

document.querySelector('.destaque-left').addEventListener('click',()=>document.getElementById('destaques').scrollBy({left:-220,behavior:'smooth'}));
document.querySelector('.destaque-right').addEventListener('click',()=>document.getElementById('destaques').scrollBy({left:220,behavior:'smooth'}));

</script>
</body>
</html>
